
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ASL data conversion &#8212; BIDS starter kit</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/js/treeData.js"></script>
    <script src="../_static/js/treeFunctions.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PET data conversion" href="pet.html" />
    <link rel="prev" title="iEEG data conversion" href="ieeg.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-VZJHGNQV6D"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-VZJHGNQV6D');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/BIDS_logo_black_transparent_background_crop.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">BIDS starter kit</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Welcome to the BIDS Starter Kit
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Folders and files
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../folders_and_files/folders.html">
   Folders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../folders_and_files/files.html">
   Filenames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../folders_and_files/metadata.html">
   Metadata and file formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/bids-standard/bids-starter-kit/tree/main/templates">
   BIDS files templates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../folders_and_files/derivatives.html">
   Derivatives
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="annotation.html">
   Annotating a BIDS dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ieeg.html">
   iEEG data conversion
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   ASL data conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pet.html">
   PET data conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mri.html">
   MRI data conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tutorials.html">
   Tutorials
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dataset_examples.html">
   BIDS data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../talks.html">
   Talks and slides
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../publications.html">
   Publications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dependencies.html">
   BIDS Dependencies List
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../links.html">
   Links and resources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Others
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../FAQ.html">
   Frequently Asked Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../validator.html">
   BIDS validation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   BIDS jargon busting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contact.html">
   Contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CONTRIBUTING.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CODE_OF_CONDUCT.html">
   Code of Conduct
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/tutorials/asl.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/bids-standard/bids-starter-kit"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/bids-standard/bids-starter-kit/issues/new?title=Issue%20on%20page%20%2Ftutorials/asl.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/bids-standard/bids-starter-kit/edit/main/src/tutorials/asl.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   ASL data conversion
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scaling">
   Scaling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ge">
     GE
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#philips">
     Philips
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#siemens">
     Siemens
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pixdim">
       PIXDIM
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>ASL data conversion</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   ASL data conversion
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scaling">
   Scaling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ge">
     GE
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#philips">
     Philips
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#siemens">
     Siemens
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pixdim">
       PIXDIM
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="asl-data-conversion">
<h1>ASL data conversion<a class="headerlink" href="#asl-data-conversion" title="Permalink to this headline">¶</a></h1>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="scaling">
<h1>Scaling<a class="headerlink" href="#scaling" title="Permalink to this headline">¶</a></h1>
<p>This paragraph discusses the specific scaling issues for GE, Philips, and Siemens.
Beware that these issues are occurring
at the time of the release of <a class="reference external" href="https://bids-specification.readthedocs.io/en/v1.5.0/">version 1.5.0</a>,
and might be resolved in the future.</p>
<div class="section" id="ge">
<h2>GE<a class="headerlink" href="#ge" title="Permalink to this headline">¶</a></h2>
<p>GE applies an RF amplifier factor that should be multiplied
by the number of signal averages (NSA) as GE sums instead of averages them.</p>
</div>
<div class="section" id="philips">
<h2>Philips<a class="headerlink" href="#philips" title="Permalink to this headline">¶</a></h2>
<p>Typically, Philips ASL datasets use the standard DICOM rescale tags only
to rescale data for viewing, whereas private rescale tags are used for scaling
to acquisition values needed for proper quantification.</p>
<p>The procedure for using both the scaling types is described previously [<strong>reference required</strong>],
although the authors did not mention that three DICOM fields are typically used for this purpose</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(2005,</span> <span class="pre">100e)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(2005,</span> <span class="pre">110e)</span></code></p></li>
<li><p>or <code class="docutils literal notranslate"><span class="pre">(2005,</span> <span class="pre">120e)</span></code>.</p></li>
</ul>
<p>It may also occur that the RescaleSlope <code class="docutils literal notranslate"><span class="pre">(0028,</span> <span class="pre">1053)</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code>
and RescaleSlopeOriginal <code class="docutils literal notranslate"><span class="pre">(2005,</span> <span class="pre">140a)</span></code> needs to be used instead.
Note that DICOM to NIfTI conversion software may omit the private slopes,
in which cases the private slope needs to be applied after running the conversion.</p>
<p>An exception is the <a class="reference external" href="https://github.com/rordenlab/dcm2niix">dcm2nii(X)</a> software
that does take private scale slopes into account in most cases.
The <a class="reference external" href="https://github.com/rordenlab/dcm2niix">dcm2nii(X)</a> versions released between 2018 and 2019-09-02
can correctly scale the NIfTI according to the private scale slopes</p>
<ul class="simple">
<li><p>if run with parameter <code class="docutils literal notranslate"><span class="pre">-p</span></code> - and indicates this by setting <code class="docutils literal notranslate"><span class="pre">UsePhilipsFloatNotDisplayScaling==1</span></code>
in the accompanying json file.</p></li>
</ul>
<p>Two exceptions apply, <a class="reference external" href="https://github.com/rordenlab/dcm2niix">dcm2nii(X)</a>
does not support DICOM tags <code class="docutils literal notranslate"><span class="pre">(2005,</span> <span class="pre">110e)</span></code> and <code class="docutils literal notranslate"><span class="pre">(2005,</span> <span class="pre">120e)</span></code>
that still need to be read and applied additionally.
Furthermore, the field RealWorldValueSlope <code class="docutils literal notranslate"><span class="pre">(0040,9225)</span></code> is sometimes provided
as an alternative to RescaleSlope <code class="docutils literal notranslate"><span class="pre">(0028,1053)</span></code>.
In this case, <a class="reference external" href="https://github.com/rordenlab/dcm2niix">dcm2nii(X)</a> outputs a field <code class="docutils literal notranslate"><span class="pre">PhilipsRWVSlope</span></code>
and sets <code class="docutils literal notranslate"><span class="pre">UsePhilipsFloatNotDisplayScaling==1</span></code>.
This is deceiving because the standard RescaleSlope is applied
instead of private-field scale slopes and this still needs to be corrected manually.</p>
<p>Note that this last-mentioned behavior is corrected in the newest dcm2nii version
and general caution is recommended when dealing with Philips scale slopes.
Also, Philips has recently implemented the option to apply these scaling factors upon export.
The scaling of acquired/reconstructed ASL images may differ between control, label, and M0 images.</p>
</div>
<div class="section" id="siemens">
<h2>Siemens<a class="headerlink" href="#siemens" title="Permalink to this headline">¶</a></h2>
<p>Several implementations of Siemens ASL WIP have a scaling between ASL and M0.
This can be only modified and obtained at the scanner console and it is set to <code class="docutils literal notranslate"><span class="pre">10</span></code> by default.</p>
<div class="section" id="pixdim">
<h3>PIXDIM<a class="headerlink" href="#pixdim" title="Permalink to this headline">¶</a></h3>
<p>The so-called PIXDIM error appears to be specific for files with a single repetition,
more specifically the separately acquired <code class="docutils literal notranslate"><span class="pre">m0scan</span></code>.
In the NIfTI header, <code class="docutils literal notranslate"><span class="pre">dim[0]</span></code> defines the number of dimensions, <code class="docutils literal notranslate"><span class="pre">dim[i]</span></code>
defines the length of the i’th dimension, <code class="docutils literal notranslate"><span class="pre">pixdim[i]</span></code> specifies the voxel width along dimension <code class="docutils literal notranslate"><span class="pre">i</span></code>.
For images with a single repetition, where <code class="docutils literal notranslate"><span class="pre">pixdim[4]</span></code> specifies the temporal width,
the BIDS validator requires that the image is defined as 4D with <code class="docutils literal notranslate"><span class="pre">dim[0]</span> <span class="pre">==</span> <span class="pre">4</span></code>,
even though the image has a single repetition <code class="docutils literal notranslate"><span class="pre">dim[4]</span> <span class="pre">==</span> <span class="pre">1</span></code>.
Defining (<code class="docutils literal notranslate"><span class="pre">dim[0]</span> <span class="pre">==</span> <span class="pre">3</span></code>) for a 44D volume with a single repetition
(for instance: a 3D image) is common and correct, however, it is considered invalid by the validator.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="ieeg.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">iEEG data conversion</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pet.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PET data conversion</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By The BIDS community<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>